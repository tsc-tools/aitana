<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>API - Aitana</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API";
        var mkdocs_page_input_path = "api.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Aitana
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../aitana_example/">How to use aitana</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">API</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Aitana</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">API</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="api-documentation">API Documentation</h2>


<div class="doc doc-object doc-module">



<a id="aitana.whakaari"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h1 id="aitana.whakaari.Seismicity" class="doc doc-heading">
            <code>Seismicity</code>


</h1>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>







              <details class="quote">
                <summary>Source code in <code>src/aitana/whakaari.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Seismicity</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rsam</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load RSAM values NZ.WIZ.10.HHZ.The first time you call</span>
<span class="sd">        this it will download the data from Zenodo and store it</span>
<span class="sd">        locally.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            :param df: Dataframe with RSAM values.</span>
<span class="sd">            :type df: :class:`pandas.DataFrame`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rsam_fn</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;data/RSAM_NZ.WIZ.10.HHZ.csv&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rsam_fn</span><span class="p">):</span>
            <span class="c1"># download the data from zenodo</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Downloading RSAM data from Zenodo&#39;</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://zenodo.org/records/14759090/files/RSAM_NZ.WIZ.10.HHZ.csv&quot;</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rsam_fn</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successfully downloaded RSAM data from Zenodo&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to download RSAM data from Zenodo&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">rsam_fn</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="s1">&#39;obs&#39;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;ISO8601&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@cache_dataframe</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">quakes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">center_point</span> <span class="o">=</span> <span class="s2">&quot;177.186833+-37.523118&quot;</span>
        <span class="k">return</span> <span class="n">wfs_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
                           <span class="n">center_point</span><span class="o">=</span><span class="n">center_point</span><span class="p">,</span> <span class="n">maxdepth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="aitana.whakaari.Seismicity.rsam" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rsam</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load RSAM values NZ.WIZ.10.HHZ.The first time you call
this it will download the data from Zenodo and store it
locally.</p>
<h4 id="aitana.whakaari.Seismicity.rsam--returns">Returns:</h4>
<pre><code>:param df: Dataframe with RSAM values.
:type df: :class:`pandas.DataFrame`
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/aitana/whakaari.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rsam</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load RSAM values NZ.WIZ.10.HHZ.The first time you call</span>
<span class="sd">    this it will download the data from Zenodo and store it</span>
<span class="sd">    locally.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        :param df: Dataframe with RSAM values.</span>
<span class="sd">        :type df: :class:`pandas.DataFrame`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rsam_fn</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;data/RSAM_NZ.WIZ.10.HHZ.csv&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rsam_fn</span><span class="p">):</span>
        <span class="c1"># download the data from zenodo</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Downloading RSAM data from Zenodo&#39;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://zenodo.org/records/14759090/files/RSAM_NZ.WIZ.10.HHZ.csv&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rsam_fn</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successfully downloaded RSAM data from Zenodo&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to download RSAM data from Zenodo&#39;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">rsam_fn</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="s1">&#39;obs&#39;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;ISO8601&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h1 id="aitana.whakaari.eruptions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eruptions</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dec_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>This function loads the eruption catalogue for White Island and
declusters it.</p>
<p>:param eruption_scale: The minimum eruption scale (between 0 and 4)
                       to use. This is currently ignored as the
                       White Island catalogue does not contain
                       eruption scale.
:type eruption_scale: int
:param dec_interval: The declustering interval, which is the minimum
                     distance in time between any two eruptions.
:type dec_interval: :class:<code>pandas.DateOffset</code> or str
:param datadir: Path that contains the catalogue file in csv format.
:type datadir: str
:returns: Declustered eruption catalogue
:rtype: :class:<code>pandas.DataFrame</code></p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/whakaari.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cache_dataframe</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">eruptions</span><span class="p">(</span><span class="n">min_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dec_interval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function loads the eruption catalogue for White Island and</span>
<span class="sd">    declusters it.</span>

<span class="sd">    :param eruption_scale: The minimum eruption scale (between 0 and 4)</span>
<span class="sd">                           to use. This is currently ignored as the</span>
<span class="sd">                           White Island catalogue does not contain</span>
<span class="sd">                           eruption scale.</span>
<span class="sd">    :type eruption_scale: int</span>
<span class="sd">    :param dec_interval: The declustering interval, which is the minimum</span>
<span class="sd">                         distance in time between any two eruptions.</span>
<span class="sd">    :type dec_interval: :class:`pandas.DateOffset` or str</span>
<span class="sd">    :param datadir: Path that contains the catalogue file in csv format.</span>
<span class="sd">    :type datadir: str</span>
<span class="sd">    :returns: Declustered eruption catalogue</span>
<span class="sd">    :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eruptions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;data/WhiteIs_Eruption_Catalogue.csv&quot;</span><span class="p">),</span>
        <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Select eruptions of a particular scale or larger</span>
    <span class="n">eruptions</span> <span class="o">=</span> <span class="n">eruptions</span><span class="p">[</span><span class="n">eruptions</span><span class="o">.</span><span class="n">Activity_Scale</span> <span class="o">&gt;=</span> <span class="n">min_size</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">dec_interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># duplicate time index as a data column</span>
        <span class="n">eruptions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;tvalue&quot;</span><span class="p">,</span> <span class="n">eruptions</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># calculate intereruption event time</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">eruptions</span><span class="p">[</span><span class="s2">&quot;tvalue&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eruptions</span><span class="p">[</span><span class="s2">&quot;tvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">eruptions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
        <span class="n">eruptions</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">dec_interval</span><span class="p">)</span>
        <span class="n">eruptions</span> <span class="o">=</span> <span class="n">eruptions</span><span class="p">[(</span><span class="n">eruptions</span><span class="o">.</span><span class="n">delta</span> <span class="o">&gt;=</span> <span class="n">dec_interval</span><span class="p">)]</span>
        <span class="n">eruptions</span> <span class="o">=</span> <span class="n">eruptions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tvalue&quot;</span><span class="p">,</span> <span class="s2">&quot;delta&quot;</span><span class="p">])</span>

    <span class="n">eruptions</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">eruptions</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">eruptions</span> <span class="o">=</span> <span class="n">eruptions</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;utc&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eruptions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="aitana.ruapehu"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h1 id="aitana.ruapehu.CraterLake" class="doc doc-heading">
            <code>CraterLake</code>


</h1>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>







              <details class="quote">
                <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CraterLake</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span>

    <span class="nd">@cache_dataframe</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resample</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">interpolate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">exclude1995</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read crater lake temperature from Tilde (https://tilde.geonet.org.nz).</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">            :param resample: Average over resampling interval and</span>
<span class="sd">                            linearly interpolate in between. The</span>
<span class="sd">                            interval should be one of &#39;D&#39;, &#39;W&#39;,</span>
<span class="sd">                            or &#39;M&#39;</span>
<span class="sd">            :type resample: str</span>
<span class="sd">            :param interpolate: Interpolate between resampled points.</span>
<span class="sd">                                Only takes effect if resample is not</span>
<span class="sd">                                None.</span>
<span class="sd">            :type interpolate: str</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            :param df: A dataframe with the temperature time series.</span>
<span class="sd">            :type df: :class:`pandas.Dataframe`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># read in datalogger temperature data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                               <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;envirosensor&quot;</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                               <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;04&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">df1</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1993</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                                <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;envirosensor&quot;</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                                <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;01&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

        <span class="c1"># Read in the manual temperatures</span>
        <span class="c1"># water analysis lab, thermometer</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dfmc1</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1954</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                                  <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                                  <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                                  <span class="n">method</span><span class="o">=</span><span class="s2">&quot;thermometer&quot;</span><span class="p">,</span>
                                  <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;MC01&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmc1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfmc1</span><span class="p">)</span>

        <span class="c1"># water analysis lab, thermocouple</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dfmc1_2</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                                    <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                                    <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;thermocouple&quot;</span><span class="p">,</span>
                                    <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;MC01&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmc1_2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfmc1_2</span><span class="p">)</span>

        <span class="c1"># thermocouple 1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dfmc3</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1998</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                                  <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                                  <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                                  <span class="n">method</span><span class="o">=</span><span class="s2">&quot;thermocouple&quot;</span><span class="p">,</span>
                                  <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;MC03&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmc3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfmc3</span><span class="p">)</span>

        <span class="c1"># thermocouple 2</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dfmc4</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                                  <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                                  <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                                  <span class="n">method</span><span class="o">=</span><span class="s2">&quot;thermocouple&quot;</span><span class="p">,</span>
                                  <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;MC04&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmc4</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfmc4</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No data found for lake temperature between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">df1</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">resample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">interpolate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interpolate</span><span class="p">)</span>

        <span class="c1"># remove observations following the 1995 eruption when</span>
        <span class="c1"># the measured temperatures do not represent a lake.</span>
        <span class="k">if</span> <span class="n">exclude1995</span><span class="p">:</span>
            <span class="n">cond1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="s2">&quot;1995-09-20 00:00:00&quot;</span>
            <span class="n">cond2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s2">&quot;2000-01-01 00:00:00&quot;</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">cond1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cond2</span><span class="p">)]</span>
        <span class="c1"># get rid of nans</span>
        <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># change annoying temp label and drop old column</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot; t (C)&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@cache_dataframe</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">water_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read crater lake water level from Tilde (https://tilde.geonet.org.nz).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;02&#39;</span><span class="p">,</span> <span class="s1">&#39;03&#39;</span><span class="p">]</span>
        <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sensor</span> <span class="ow">in</span> <span class="n">sensors</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                                   <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;envirosensor&quot;</span><span class="p">,</span>
                                   <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-height&quot;</span><span class="p">,</span>
                                   <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="n">sensor</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">df1</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@cache_dataframe</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">water_analyte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyte</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resample</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">interpolate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">exclude1995</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download water analyte data from Tilde (https://tilde.geonet.org.nz).</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">            analyte : str</span>
<span class="sd">                The analyte to download. This can be one of</span>
<span class="sd">                    &#39;Al, &#39;As&#39;, &#39;B&#39;, &#39;Br&#39;, &#39;Ca&#39;, &#39;Cl&#39;, &#39;Cs&#39;, &#39;F&#39;,</span>
<span class="sd">                    &#39;Fe&#39;, &#39;H2S&#39;, &#39;K&#39;, &#39;Li&#39;, &#39;Mg&#39;, &#39;NH3&#39;, &#39;NO3-N&#39;, &#39;Na&#39;,</span>
<span class="sd">                    &#39;PO4-P&#39;, &#39;Rb&#39;, &#39;SO4&#39;, &#39;SiO2&#39;, &#39;d18O&#39;, &#39;d2H&#39;, &#39;ph&#39;</span>
<span class="sd">            resample : str</span>
<span class="sd">                Resample the data to a given interval. This can be anything</span>
<span class="sd">                allowed by :pandas.DataFrame.resample:. </span>
<span class="sd">            interpolate : str</span>
<span class="sd">                Interpolate between points. This can be anything allowed by</span>
<span class="sd">                :pandas.DataFrame.interpolate:.</span>
<span class="sd">            exclude1995 : bool</span>
<span class="sd">                Exclude data from 1995 when there wasn&#39;t a lake.</span>
<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            pandas.DataFrame</span>
<span class="sd">                A dataframe with the water analyte time series.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MC03&quot;</span><span class="p">,</span> <span class="s2">&quot;MC04&quot;</span><span class="p">,</span> <span class="s2">&quot;MC01&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sensor</span> <span class="ow">in</span> <span class="n">sensors</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1964</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
                                   <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                                   <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                                   <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;lake-</span><span class="si">{</span><span class="n">analyte</span><span class="si">}</span><span class="s2">-conc&quot;</span><span class="p">,</span>
                                   <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                                   <span class="n">sensor</span><span class="o">=</span><span class="n">sensor</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No data found for </span><span class="si">{</span><span class="n">analyte</span><span class="si">}</span><span class="s2"> between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">df1</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">resample</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">interpolate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interpolate</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exclude1995</span><span class="p">:</span>
            <span class="n">cond1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="s2">&quot;1995-09-20 00:00:00&quot;</span>
            <span class="n">cond2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s2">&quot;2000-01-01 00:00:00&quot;</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">cond1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cond2</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="aitana.ruapehu.CraterLake.temperature" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">temperature</span><span class="p">(</span><span class="n">resample</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude1995</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read crater lake temperature from Tilde (https://tilde.geonet.org.nz).</p>
<h4 id="aitana.ruapehu.CraterLake.temperature--parameters">Parameters:</h4>
<pre><code>:param resample: Average over resampling interval and
                linearly interpolate in between. The
                interval should be one of 'D', 'W',
                or 'M'
:type resample: str
:param interpolate: Interpolate between resampled points.
                    Only takes effect if resample is not
                    None.
:type interpolate: str
</code></pre>
<h4 id="aitana.ruapehu.CraterLake.temperature--returns">Returns:</h4>
<pre><code>:param df: A dataframe with the temperature time series.
:type df: :class:`pandas.Dataframe`
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cache_dataframe</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resample</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">interpolate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">exclude1995</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read crater lake temperature from Tilde (https://tilde.geonet.org.nz).</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">        :param resample: Average over resampling interval and</span>
<span class="sd">                        linearly interpolate in between. The</span>
<span class="sd">                        interval should be one of &#39;D&#39;, &#39;W&#39;,</span>
<span class="sd">                        or &#39;M&#39;</span>
<span class="sd">        :type resample: str</span>
<span class="sd">        :param interpolate: Interpolate between resampled points.</span>
<span class="sd">                            Only takes effect if resample is not</span>
<span class="sd">                            None.</span>
<span class="sd">        :type interpolate: str</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        :param df: A dataframe with the temperature time series.</span>
<span class="sd">        :type df: :class:`pandas.Dataframe`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># read in datalogger temperature data</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                           <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;envirosensor&quot;</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                           <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;04&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1993</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                            <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;envirosensor&quot;</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                            <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;01&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

    <span class="c1"># Read in the manual temperatures</span>
    <span class="c1"># water analysis lab, thermometer</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dfmc1</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1954</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                              <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                              <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                              <span class="n">method</span><span class="o">=</span><span class="s2">&quot;thermometer&quot;</span><span class="p">,</span>
                              <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;MC01&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmc1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfmc1</span><span class="p">)</span>

    <span class="c1"># water analysis lab, thermocouple</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dfmc1_2</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                                <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                                <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;thermocouple&quot;</span><span class="p">,</span>
                                <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;MC01&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmc1_2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfmc1_2</span><span class="p">)</span>

    <span class="c1"># thermocouple 1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dfmc3</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1998</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                              <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                              <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                              <span class="n">method</span><span class="o">=</span><span class="s2">&quot;thermocouple&quot;</span><span class="p">,</span>
                              <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;MC03&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmc3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfmc3</span><span class="p">)</span>

    <span class="c1"># thermocouple 2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dfmc4</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                              <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-temperature&quot;</span><span class="p">,</span>
                              <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                              <span class="n">method</span><span class="o">=</span><span class="s2">&quot;thermocouple&quot;</span><span class="p">,</span>
                              <span class="n">sensor</span><span class="o">=</span><span class="s2">&quot;MC04&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmc4</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfmc4</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No data found for lake temperature between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">df1</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">interpolate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interpolate</span><span class="p">)</span>

    <span class="c1"># remove observations following the 1995 eruption when</span>
    <span class="c1"># the measured temperatures do not represent a lake.</span>
    <span class="k">if</span> <span class="n">exclude1995</span><span class="p">:</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="s2">&quot;1995-09-20 00:00:00&quot;</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s2">&quot;2000-01-01 00:00:00&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">cond1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cond2</span><span class="p">)]</span>
    <span class="c1"># get rid of nans</span>
    <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># change annoying temp label and drop old column</span>
    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot; t (C)&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="aitana.ruapehu.CraterLake.water_analyte" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">water_analyte</span><span class="p">(</span><span class="n">analyte</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude1995</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Download water analyte data from Tilde (https://tilde.geonet.org.nz).</p>
<h4 id="aitana.ruapehu.CraterLake.water_analyte--parameters">Parameters:</h4>
<pre><code>analyte : str
    The analyte to download. This can be one of
        'Al, 'As', 'B', 'Br', 'Ca', 'Cl', 'Cs', 'F',
        'Fe', 'H2S', 'K', 'Li', 'Mg', 'NH3', 'NO3-N', 'Na',
        'PO4-P', 'Rb', 'SO4', 'SiO2', 'd18O', 'd2H', 'ph'
resample : str
    Resample the data to a given interval. This can be anything
    allowed by :pandas.DataFrame.resample:. 
interpolate : str
    Interpolate between points. This can be anything allowed by
    :pandas.DataFrame.interpolate:.
exclude1995 : bool
    Exclude data from 1995 when there wasn't a lake.
</code></pre>
<h4 id="aitana.ruapehu.CraterLake.water_analyte--returns">Returns:</h4>
<pre><code>pandas.DataFrame
    A dataframe with the water analyte time series.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cache_dataframe</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">water_analyte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyte</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resample</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">interpolate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">exclude1995</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download water analyte data from Tilde (https://tilde.geonet.org.nz).</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">        analyte : str</span>
<span class="sd">            The analyte to download. This can be one of</span>
<span class="sd">                &#39;Al, &#39;As&#39;, &#39;B&#39;, &#39;Br&#39;, &#39;Ca&#39;, &#39;Cl&#39;, &#39;Cs&#39;, &#39;F&#39;,</span>
<span class="sd">                &#39;Fe&#39;, &#39;H2S&#39;, &#39;K&#39;, &#39;Li&#39;, &#39;Mg&#39;, &#39;NH3&#39;, &#39;NO3-N&#39;, &#39;Na&#39;,</span>
<span class="sd">                &#39;PO4-P&#39;, &#39;Rb&#39;, &#39;SO4&#39;, &#39;SiO2&#39;, &#39;d18O&#39;, &#39;d2H&#39;, &#39;ph&#39;</span>
<span class="sd">        resample : str</span>
<span class="sd">            Resample the data to a given interval. This can be anything</span>
<span class="sd">            allowed by :pandas.DataFrame.resample:. </span>
<span class="sd">        interpolate : str</span>
<span class="sd">            Interpolate between points. This can be anything allowed by</span>
<span class="sd">            :pandas.DataFrame.interpolate:.</span>
<span class="sd">        exclude1995 : bool</span>
<span class="sd">            Exclude data from 1995 when there wasn&#39;t a lake.</span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A dataframe with the water analyte time series.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MC03&quot;</span><span class="p">,</span> <span class="s2">&quot;MC04&quot;</span><span class="p">,</span> <span class="s2">&quot;MC01&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">sensor</span> <span class="ow">in</span> <span class="n">sensors</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1964</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
                               <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                               <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;manualcollect&quot;</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;lake-</span><span class="si">{</span><span class="n">analyte</span><span class="si">}</span><span class="s2">-conc&quot;</span><span class="p">,</span>
                               <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span>
                               <span class="n">sensor</span><span class="o">=</span><span class="n">sensor</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No data found for </span><span class="si">{</span><span class="n">analyte</span><span class="si">}</span><span class="s2"> between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">df1</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">resample</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">interpolate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interpolate</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">exclude1995</span><span class="p">:</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="s2">&quot;1995-09-20 00:00:00&quot;</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s2">&quot;2000-01-01 00:00:00&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">cond1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cond2</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="aitana.ruapehu.CraterLake.water_level" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">water_level</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read crater lake water level from Tilde (https://tilde.geonet.org.nz).</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cache_dataframe</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">water_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read crater lake water level from Tilde (https://tilde.geonet.org.nz).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;02&#39;</span><span class="p">,</span> <span class="s1">&#39;03&#39;</span><span class="p">]</span>
    <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sensor</span> <span class="ow">in</span> <span class="n">sensors</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                               <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;envirosensor&quot;</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lake-height&quot;</span><span class="p">,</span>
                               <span class="n">station</span><span class="o">=</span><span class="s2">&quot;RU001&quot;</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="n">sensor</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">df1</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h1 id="aitana.ruapehu.Seismicity" class="doc doc-heading">
            <code>Seismicity</code>


</h1>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>







              <details class="quote">
                <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Seismicity</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span>

    <span class="nd">@cache_dataframe</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">regional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load an earthquake catalogue for an area containing Waiouru and National Park.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">polygon</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;175.32+-39.50,+175.32+-39.18,+175.77+-39.18,+175.77+-39.50,+175.32+-39.50&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">wfs_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="n">polygon</span><span class="p">)</span>

    <span class="nd">@cache_dataframe</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">cone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load an earthquake catalogue for an area of 7 km around the summit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">7000</span>
        <span class="n">center_point</span> <span class="o">=</span> <span class="s2">&quot;175.57+-39.28&quot;</span>
        <span class="k">return</span> <span class="n">wfs_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center_point</span><span class="o">=</span><span class="n">center_point</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rm_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">cat2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove events from catalogue cat1 that are also in cat2 and return a new catalogue.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">            cat1 : pandas.DataFrame</span>
<span class="sd">                The first catalogue.</span>
<span class="sd">            cat2 : pandas.DataFrame</span>
<span class="sd">                The second catalogue.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            pandas.DataFrame</span>
<span class="sd">                A new catalogue with the events from cat1 that are not in cat2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cat_tmp</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cat_tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">cat_tmp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">publicid</span> <span class="ow">in</span> <span class="n">cat2</span><span class="o">.</span><span class="n">publicid</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">dates_to_drop</span> <span class="o">=</span> <span class="n">cat_tmp</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
        <span class="n">cat_tmp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dates_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cat_tmp</span>

    <span class="k">def</span> <span class="nf">daily_rsam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load RSAM values from DRZ, MAVZ and FWVZ combined by scaling</span>
<span class="sd">        MAVZ and FWVZ RSAM values with DRZ.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            :param df: Dataframe with RSAM values.</span>
<span class="sd">            :type df: :class:`pandas.DataFrame`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;data/ruapehu_rsam.csv&quot;</span><span class="p">),</span>
                         <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">update</span><span class="p">:</span>
            <span class="n">df_drz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;data/DRZ_scaled_MAVZ.csv&quot;</span><span class="p">),</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">df_drz</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;RSAM&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://kaizen.gns.cri.nz:9157/feature?name=rsam&quot;</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;&amp;starttime=2007-01-01T00:00:00&quot;</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;endtime=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;&amp;volcano=Ruapehu&amp;site=FWVZ&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df_fwvz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                    <span class="n">url</span><span class="p">,</span>
                    <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">date_format</span><span class="o">=</span><span class="s2">&quot;ISO8601&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="n">df_fwvz</span><span class="p">[</span><span class="s2">&quot;rsam&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">df_fwvz</span><span class="p">[</span><span class="s2">&quot;rsam&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e30</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df_fwvz</span><span class="p">[</span><span class="s2">&quot;rsam&quot;</span><span class="p">])</span>
            <span class="n">df_fwvz_daily</span> <span class="o">=</span> <span class="n">df_fwvz</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;1D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df_fwvz_daily_scaled</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.3945</span> <span class="o">+</span> <span class="mf">3.5062</span> <span class="o">*</span> <span class="n">df_fwvz_daily</span>
            <span class="n">df_fwvz_daily_scaled</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rsam&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_drz</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df_fwvz_daily_scaled</span><span class="p">)</span>
            <span class="c1"># remove duplicated dates:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(),</span> <span class="p">:]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;data/ruapehu_rsam.csv&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="aitana.ruapehu.Seismicity.cone" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cone</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load an earthquake catalogue for an area of 7 km around the summit.</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cache_dataframe</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">cone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load an earthquake catalogue for an area of 7 km around the summit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mi">7000</span>
    <span class="n">center_point</span> <span class="o">=</span> <span class="s2">&quot;175.57+-39.28&quot;</span>
    <span class="k">return</span> <span class="n">wfs_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center_point</span><span class="o">=</span><span class="n">center_point</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="aitana.ruapehu.Seismicity.daily_rsam" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">daily_rsam</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load RSAM values from DRZ, MAVZ and FWVZ combined by scaling
MAVZ and FWVZ RSAM values with DRZ.</p>
<h4 id="aitana.ruapehu.Seismicity.daily_rsam--returns">Returns:</h4>
<pre><code>:param df: Dataframe with RSAM values.
:type df: :class:`pandas.DataFrame`
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">daily_rsam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load RSAM values from DRZ, MAVZ and FWVZ combined by scaling</span>
<span class="sd">    MAVZ and FWVZ RSAM values with DRZ.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        :param df: Dataframe with RSAM values.</span>
<span class="sd">        :type df: :class:`pandas.DataFrame`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;data/ruapehu_rsam.csv&quot;</span><span class="p">),</span>
                     <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">update</span><span class="p">:</span>
        <span class="n">df_drz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;data/DRZ_scaled_MAVZ.csv&quot;</span><span class="p">),</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">df_drz</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;RSAM&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://kaizen.gns.cri.nz:9157/feature?name=rsam&quot;</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;&amp;starttime=2007-01-01T00:00:00&quot;</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;endtime=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;&amp;volcano=Ruapehu&amp;site=FWVZ&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df_fwvz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">date_format</span><span class="o">=</span><span class="s2">&quot;ISO8601&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="n">df_fwvz</span><span class="p">[</span><span class="s2">&quot;rsam&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">df_fwvz</span><span class="p">[</span><span class="s2">&quot;rsam&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e30</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df_fwvz</span><span class="p">[</span><span class="s2">&quot;rsam&quot;</span><span class="p">])</span>
        <span class="n">df_fwvz_daily</span> <span class="o">=</span> <span class="n">df_fwvz</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;1D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">df_fwvz_daily_scaled</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.3945</span> <span class="o">+</span> <span class="mf">3.5062</span> <span class="o">*</span> <span class="n">df_fwvz_daily</span>
        <span class="n">df_fwvz_daily_scaled</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rsam&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df_drz</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df_fwvz_daily_scaled</span><span class="p">)</span>
        <span class="c1"># remove duplicated dates:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(),</span> <span class="p">:]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;data/ruapehu_rsam.csv&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="aitana.ruapehu.Seismicity.regional" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">regional</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load an earthquake catalogue for an area containing Waiouru and National Park.</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cache_dataframe</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">regional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load an earthquake catalogue for an area containing Waiouru and National Park.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">polygon</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;175.32+-39.50,+175.32+-39.18,+175.77+-39.18,+175.77+-39.50,+175.32+-39.50&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">wfs_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="n">polygon</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="aitana.ruapehu.Seismicity.rm_duplicates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rm_duplicates</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Remove events from catalogue cat1 that are also in cat2 and return a new catalogue.</p>
<h4 id="aitana.ruapehu.Seismicity.rm_duplicates--parameters">Parameters:</h4>
<pre><code>cat1 : pandas.DataFrame
    The first catalogue.
cat2 : pandas.DataFrame
    The second catalogue.
</code></pre>
<h4 id="aitana.ruapehu.Seismicity.rm_duplicates--returns">Returns:</h4>
<pre><code>pandas.DataFrame
    A new catalogue with the events from cat1 that are not in cat2.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rm_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">cat2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove events from catalogue cat1 that are also in cat2 and return a new catalogue.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">        cat1 : pandas.DataFrame</span>
<span class="sd">            The first catalogue.</span>
<span class="sd">        cat2 : pandas.DataFrame</span>
<span class="sd">            The second catalogue.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A new catalogue with the events from cat1 that are not in cat2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cat_tmp</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cat_tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">cat_tmp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">publicid</span> <span class="ow">in</span> <span class="n">cat2</span><span class="o">.</span><span class="n">publicid</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">dates_to_drop</span> <span class="o">=</span> <span class="n">cat_tmp</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
    <span class="n">cat_tmp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dates_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cat_tmp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h1 id="aitana.ruapehu.eruptions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eruptions</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dec_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>This function loads the eruption catalogue for Mt. Ruapehu and declusters
it if required. The catalogue is based on Brad Scott's GNS Science Report.
Declustering is turned on if dec_interval is greater than zero. This will
also exclude magmatic eruption episodes between 9 January 1944 and
8 January 1946 as well as 6 January 1995 to 12 January 1997 as these aren't
independent events.</p>
<h3 id="aitana.ruapehu.eruptions--parameters">Parameters:</h3>
<pre><code>min_size : int
    The minimum eruption size to include in the catalogue.
dec_interval : str 
    The declustering interval in pandas complient time delta format.
</code></pre>
<h3 id="aitana.ruapehu.eruptions--returns">Returns:</h3>
<pre><code>pandas.DataFrame
    A dataframe with the (declustered) eruption catalogue.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/aitana/ruapehu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cache_dataframe</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">eruptions</span><span class="p">(</span><span class="n">min_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dec_interval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function loads the eruption catalogue for Mt. Ruapehu and declusters</span>
<span class="sd">    it if required. The catalogue is based on Brad Scott&#39;s GNS Science Report.</span>
<span class="sd">    Declustering is turned on if dec_interval is greater than zero. This will</span>
<span class="sd">    also exclude magmatic eruption episodes between 9 January 1944 and</span>
<span class="sd">    8 January 1946 as well as 6 January 1995 to 12 January 1997 as these aren&#39;t</span>
<span class="sd">    independent events.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">        min_size : int</span>
<span class="sd">            The minimum eruption size to include in the catalogue.</span>
<span class="sd">        dec_interval : str </span>
<span class="sd">            The declustering interval in pandas complient time delta format.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A dataframe with the (declustered) eruption catalogue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GeoNet/data/refs/heads/main/&quot;</span>
    <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;historic-volcanic-activity/historic_eruptive_activity_ruapehu.csv&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>

    <span class="c1"># Select eruptions of a particular scale or larger</span>
    <span class="n">scaled_eruptions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Activity Scale&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_size</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">dec_interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># duplicate time index as a data column</span>
        <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;tvalue&quot;</span><span class="p">,</span> <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># calculate intereruption event time</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">scaled_eruptions</span><span class="p">[</span><span class="s2">&quot;tvalue&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">scaled_eruptions</span><span class="p">[</span><span class="s2">&quot;tvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
        <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">dec_interval</span><span class="p">)</span>
        <span class="c1"># Exclude certain date ranges from calculations to ensure a more</span>
        <span class="c1"># Poisson-like process by removing long term eruption periods.</span>
        <span class="n">period1</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="s2">&quot;1944-10-01 00:00:00&quot;</span>
        <span class="n">period2</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="s2">&quot;1946-08-01 00:00:00&quot;</span>
        <span class="n">scaled_eruptions</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="p">[</span><span class="n">period1</span> <span class="o">|</span> <span class="n">period2</span><span class="p">]</span>
        <span class="n">period3</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="s2">&quot;1995-07-01 00:00:00&quot;</span>
        <span class="n">period4</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="s2">&quot;1997-12-01 00:00:00&quot;</span>
        <span class="n">scaled_eruptions</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="p">[</span><span class="n">period3</span> <span class="o">|</span> <span class="n">period4</span><span class="p">]</span>
        <span class="n">scaled_eruptions</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="p">[(</span>
            <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">delta</span> <span class="o">&gt;=</span> <span class="n">dec_interval</span><span class="p">)]</span>
        <span class="n">scaled_eruptions</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="s2">&quot;tvalue&quot;</span><span class="p">])</span>
    <span class="n">scaled_eruptions</span> <span class="o">=</span> <span class="n">scaled_eruptions</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;utc&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scaled_eruptions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="aitana.util"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h1 id="aitana.util._is_class_method" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_is_class_method</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>Check if a function is a class method.</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_is_class_method</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a function is a class method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">func_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func_params</span> <span class="ow">and</span> <span class="n">func_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h1 id="aitana.util.cache_dataframe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cache_dataframe</span><span class="p">(</span><span class="n">cache_dir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>Decorator to cache pandas DataFrames, handle date ranges, and persist the cache to disk.</p>
<p>Args:
    cache_key (str): The attribute name for the cached DataFrame.
    use_class_attrs (bool): If True, fetch start_date and end_date from the class instance if available.
    cache_file (str): Filepath for persisting the cache.</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cache_dataframe</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator to cache pandas DataFrames, handle date ranges, and persist the cache to disk.</span>

<span class="sd">    Args:</span>
<span class="sd">        cache_key (str): The attribute name for the cached DataFrame.</span>
<span class="sd">        use_class_attrs (bool): If True, fetch start_date and end_date from the class instance if available.</span>
<span class="sd">        cache_file (str): Filepath for persisting the cache.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_dir</span><span class="p">:</span>
        <span class="n">cache_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s2">&quot;.aitana_cache&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">cache_key</span> <span class="o">=</span> <span class="n">generate_cache_filename</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cache_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clear_cache</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_file</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cache_file</span><span class="p">)</span>

            <span class="n">instance</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">_is_class_method</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Use instance attributes if not explicitly provided</span>
                <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s1">&#39;end_date&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">instance</span><span class="p">,</span> <span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;end_date must be provided.&quot;</span><span class="p">)</span>

            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Load the cache from disk if it exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="s1">&#39;cached_df&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_file</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading cache from </span><span class="si">{</span><span class="n">cache_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">cached_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                        <span class="n">cache_file</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">date_format</span><span class="o">=</span><span class="s2">&quot;ISO8601&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cached_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="s1">&#39;cached_df&#39;</span><span class="p">,</span> <span class="n">cached_df</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cached_df</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="s1">&#39;cached_df&#39;</span><span class="p">)</span>

            <span class="c1"># Check the date range of the cached data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">cached_end</span> <span class="o">=</span> <span class="n">cached_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cached_end</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Determine missing ranges</span>
            <span class="n">missing_end</span> <span class="o">=</span> <span class="n">end_date</span> <span class="k">if</span> <span class="n">cached_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">end_date</span> <span class="o">&gt;</span> <span class="n">cached_end</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="c1"># If there are missing ranges, fetch the data</span>
            <span class="k">if</span> <span class="n">missing_end</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetching missing data...&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s1">&#39;end_date&#39;</span><span class="p">,</span> <span class="n">missing_end</span><span class="p">)</span>
                    <span class="n">missing_data</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">missing_data</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="n">missing_data</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">missing_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;The decorated function must return a pandas DataFrame.&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">missing_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">missing_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
                        <span class="n">missing_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># Ensure the index is datetime</span>

                <span class="c1"># Update the cache</span>
                <span class="n">cached_df</span> <span class="o">=</span> <span class="n">missing_data</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="s1">&#39;cached_df&#39;</span><span class="p">,</span> <span class="n">cached_df</span><span class="p">)</span>

                <span class="c1"># Persist the updated cache to disk</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving cache to </span><span class="si">{</span><span class="n">cache_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">cached_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">cache_file</span><span class="p">)</span>
            <span class="c1"># Return the relevant slice of the cached DataFrame</span>
            <span class="n">return_df</span> <span class="o">=</span> <span class="n">cached_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start_date</span><span class="p">:</span><span class="n">end_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">return_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data available for the given date range.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">return_df</span>

        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h1 id="aitana.util.eqRate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eqRate</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">fixed_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fixed_nevents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enddate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>Compute earthquake rate.</p>
<p>:param cat: A catalogue of earthquakes as returned by
            :method:<code>pyvolprob.load_ruapehu_earthquakes</code>
:type cat: :class:<code>pandas.DataFrame</code>
:param fixed_time: If not 'None', compute the earthquake rate
                   based on a fixed-length time window given in
                   days.
:type fixed_time: int
:param fixed_nevents: If not None, compute the earthquake rate
                      based on a fixed number of events.
:type fixed_nevents: int
:param enddate: The latest date of the time-series.
                Mainly needed for testing.
:type enddate: :class:<code>datetime.datetime</code></p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eqRate</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">fixed_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fixed_nevents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enddate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute earthquake rate.</span>

<span class="sd">    :param cat: A catalogue of earthquakes as returned by</span>
<span class="sd">                :method:`pyvolprob.load_ruapehu_earthquakes`</span>
<span class="sd">    :type cat: :class:`pandas.DataFrame`</span>
<span class="sd">    :param fixed_time: If not &#39;None&#39;, compute the earthquake rate</span>
<span class="sd">                       based on a fixed-length time window given in</span>
<span class="sd">                       days.</span>
<span class="sd">    :type fixed_time: int</span>
<span class="sd">    :param fixed_nevents: If not None, compute the earthquake rate</span>
<span class="sd">                          based on a fixed number of events.</span>
<span class="sd">    :type fixed_nevents: int</span>
<span class="sd">    :param enddate: The latest date of the time-series.</span>
<span class="sd">                    Mainly needed for testing.</span>
<span class="sd">    :type enddate: :class:`datetime.datetime`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fixed_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fixed_nevents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Please define either &#39;fixed_time&#39; or &#39;fixed_nevents&#39;&quot;</span><span class="p">)</span>

    <span class="n">dates</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="n">fixed_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">enddate</span><span class="p">])])</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">D&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fixed_time</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="n">fixed_time</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">index</span> <span class="o">-=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">D&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fixed_time</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;obs&quot;</span><span class="p">:</span> <span class="n">ds</span><span class="p">})</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;utc&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">fixed_nevents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nevents</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">aBin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nevents</span> <span class="o">-</span> <span class="n">fixed_nevents</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
        <span class="n">aRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nevents</span> <span class="o">-</span> <span class="n">fixed_nevents</span><span class="p">)</span>
        <span class="n">iS</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fixed_nevents</span><span class="p">,</span> <span class="n">nevents</span><span class="p">):</span>
            <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">fixed_nevents</span><span class="p">,</span> <span class="n">s</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span> <span class="o">-</span> <span class="n">dates</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;timedelta64[s]&quot;</span><span class="p">)</span>
            <span class="n">dt_days</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="mf">86400.0</span>
            <span class="n">aBin</span><span class="p">[</span><span class="n">iS</span><span class="p">]</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">aRate</span><span class="p">[</span><span class="n">iS</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixed_nevents</span> <span class="o">/</span> <span class="n">dt_days</span>
            <span class="n">iS</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;obs&quot;</span><span class="p">:</span> <span class="n">aRate</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">aBin</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;utc&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Please define either &#39;fixed_time&#39; or &#39;fixed_nevents&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h1 id="aitana.util.generate_cache_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_cache_filename</span><span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>Generate a unique filename for caching based on function name and arguments.</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_cache_filename</span><span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a unique filename for caching based on function name and arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Serialize arguments to a string representation</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span>
        <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;__class__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">instance</span><span class="p">:</span>
        <span class="n">args_repr</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_repr</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">kwargs_repr</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

    <span class="c1"># Combine everything into a single string</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">args_repr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">kwargs_repr</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Hash the combined string to ensure the filename is valid and not too long</span>
    <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">combined</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
    <span class="n">hashed_name</span> <span class="o">=</span> <span class="n">hash_object</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="c1"># Construct the filename</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashed_name</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Use .pkl for cached dataframes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h1 id="aitana.util.gradient" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gradient</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s1">&#39;14D&#39;</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>Compute gradient for time series by first smoothing
the time series and then computing the first-order difference.</p>
<h3 id="aitana.util.gradient--parameters">Parameters:</h3>
<pre><code>:param df: Dataframe
:type df: :class:`~pandas.DataFrame`
:param period: Period over which to compute a rolling mean.
:type period: str
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/aitana/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gradient</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s2">&quot;14D&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute gradient for time series by first smoothing</span>
<span class="sd">    the time series and then computing the first-order difference.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">        :param df: Dataframe</span>
<span class="sd">        :type df: :class:`~pandas.DataFrame`</span>
<span class="sd">        :param period: Period over which to compute a rolling mean.</span>
<span class="sd">        :type period: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_smooth</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df_grad</span> <span class="o">=</span> <span class="n">df_smooth</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
    <span class="n">df_grad</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_grad</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;obs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">df_grad</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h1 id="aitana.util.reindex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reindex</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">fill_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ffill_interval</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>Reindex and forward fill to generate a
timeseries that can be used to set the evidence
for a BN.</p>
<p>:param df: Dataframe to reindex
:type df: :class:<code>pandas.DataFrame</code>
:param dates: new date index
:type dates: :class:<code>pandas.DataTimeIndex</code>
:param ffill_interval: Best-by interval for data
:type ffill_interval: int</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reindex</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">fill_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ffill_interval</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reindex and forward fill to generate a</span>
<span class="sd">    timeseries that can be used to set the evidence</span>
<span class="sd">    for a BN.</span>

<span class="sd">    :param df: Dataframe to reindex</span>
<span class="sd">    :type df: :class:`pandas.DataFrame`</span>
<span class="sd">    :param dates: new date index</span>
<span class="sd">    :type dates: :class:`pandas.DataTimeIndex`</span>
<span class="sd">    :param ffill_interval: Best-by interval for data</span>
<span class="sd">    :type ffill_interval: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fill_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;obs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">fill_method</span> <span class="o">==</span> <span class="s2">&quot;ffill&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;obs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">ffill_interval</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">fill_method</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;obs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_tmp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;fill_method&#39; has to be one of &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;[None, &#39;ffill&#39;, &#39;interpolate&#39;]&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="aitana.assimilate"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h1 id="aitana.assimilate.LocalLinearTrend" class="doc doc-heading">
            <code>LocalLinearTrend</code>


</h1>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="statsmodels.tsa.statespace.mlemodel.MLEModel">MLEModel</span></code></p>







              <details class="quote">
                <summary>Source code in <code>src/aitana/assimilate.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LocalLinearTrend</span><span class="p">(</span><span class="n">MLEModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">obs_cov</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Univariate Local Linear Trend Model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Model order</span>
        <span class="n">k_states</span> <span class="o">=</span> <span class="n">k_posdef</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">obs_cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_cov_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">obs_cov</span><span class="p">)</span>
            <span class="n">obs_cov</span> <span class="o">=</span> <span class="n">obs_cov</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>


        <span class="c1"># Initialize the statespace</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LocalLinearTrend</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">endog</span><span class="p">,</span> <span class="n">k_states</span><span class="o">=</span><span class="n">k_states</span><span class="p">,</span> <span class="n">k_posdef</span><span class="o">=</span><span class="n">k_posdef</span><span class="p">,</span>
            <span class="n">initialization</span><span class="o">=</span><span class="s1">&#39;approximate_diffuse&#39;</span><span class="p">,</span>
            <span class="n">loglikelihood_burn</span><span class="o">=</span><span class="n">k_states</span>
        <span class="p">)</span>
        <span class="c1"># Initialize the matrices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;design&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;selection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k_states</span><span class="p">)</span>

        <span class="c1"># Cache some indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_cov_idx</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;state_cov&#39;</span><span class="p">,)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="n">k_posdef</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obs_cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;obs_cov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs_cov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_cov</span> <span class="o">=</span> <span class="n">obs_cov</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># This method must be set to allow forecasting in custom</span>
        <span class="c1"># state space models that include time-varying state</span>
        <span class="c1"># space matrices, like we have for state_intercept here</span>
        <span class="n">obs_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_cov_median</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">obs_cov</span><span class="o">=</span><span class="n">obs_cov</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mod</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;sigma2.measurement&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma2.level&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma2.trend&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;sigma2.level&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma2.trend&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">transform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unconstrained</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">untransform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constrained</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">constrained</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LocalLinearTrend</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Observation covariance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;obs_cov&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># State covariance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_cov_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># State covariance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_cov_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="aitana.assimilate.LocalLinearTrend.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">obs_cov</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Univariate Local Linear Trend Model</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/assimilate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">obs_cov</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Univariate Local Linear Trend Model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Model order</span>
    <span class="n">k_states</span> <span class="o">=</span> <span class="n">k_posdef</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">obs_cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_cov_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">obs_cov</span><span class="p">)</span>
        <span class="n">obs_cov</span> <span class="o">=</span> <span class="n">obs_cov</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>


    <span class="c1"># Initialize the statespace</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">LocalLinearTrend</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">endog</span><span class="p">,</span> <span class="n">k_states</span><span class="o">=</span><span class="n">k_states</span><span class="p">,</span> <span class="n">k_posdef</span><span class="o">=</span><span class="n">k_posdef</span><span class="p">,</span>
        <span class="n">initialization</span><span class="o">=</span><span class="s1">&#39;approximate_diffuse&#39;</span><span class="p">,</span>
        <span class="n">loglikelihood_burn</span><span class="o">=</span><span class="n">k_states</span>
    <span class="p">)</span>
    <span class="c1"># Initialize the matrices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;design&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;selection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k_states</span><span class="p">)</span>

    <span class="c1"># Cache some indices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_cov_idx</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;state_cov&#39;</span><span class="p">,)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="n">k_posdef</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obs_cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;obs_cov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs_cov</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">obs_cov</span> <span class="o">=</span> <span class="n">obs_cov</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h1 id="aitana.assimilate.SemiLinearTrend" class="doc doc-heading">
            <code>SemiLinearTrend</code>


</h1>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="statsmodels.tsa.statespace.mlemodel.MLEModel">MLEModel</span></code></p>







              <details class="quote">
                <summary>Source code in <code>src/aitana/assimilate.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SemiLinearTrend</span><span class="p">(</span><span class="n">MLEModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Univariate Local Linear Trend Model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Model order</span>
        <span class="n">k_states</span> <span class="o">=</span> <span class="n">k_posdef</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># Initialize the statespace</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SemiLinearTrend</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">endog</span><span class="p">,</span> <span class="n">k_states</span><span class="o">=</span><span class="n">k_states</span><span class="p">,</span> <span class="n">k_posdef</span><span class="o">=</span><span class="n">k_posdef</span><span class="p">,</span>
            <span class="n">initialization</span><span class="o">=</span><span class="s1">&#39;approximate_diffuse&#39;</span><span class="p">,</span>
            <span class="n">loglikelihood_burn</span><span class="o">=</span><span class="n">k_states</span><span class="p">)</span>

        <span class="c1"># Initialize the matrices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;design&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;selection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k_states</span><span class="p">)</span>

        <span class="c1"># Cache some indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_cov_idx</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;state_cov&#39;</span><span class="p">,)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="n">k_posdef</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;sigma2.measurement&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma2.level&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma2.trend&#39;</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">transform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unconstrained</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">untransform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constrained</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">constrained</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SemiLinearTrend</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Observation covariance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;obs_cov&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># State covariance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_cov_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;transition&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="aitana.assimilate.SemiLinearTrend.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Univariate Local Linear Trend Model</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/assimilate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Univariate Local Linear Trend Model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Model order</span>
    <span class="n">k_states</span> <span class="o">=</span> <span class="n">k_posdef</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># Initialize the statespace</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SemiLinearTrend</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">endog</span><span class="p">,</span> <span class="n">k_states</span><span class="o">=</span><span class="n">k_states</span><span class="p">,</span> <span class="n">k_posdef</span><span class="o">=</span><span class="n">k_posdef</span><span class="p">,</span>
        <span class="n">initialization</span><span class="o">=</span><span class="s1">&#39;approximate_diffuse&#39;</span><span class="p">,</span>
        <span class="n">loglikelihood_burn</span><span class="o">=</span><span class="n">k_states</span><span class="p">)</span>

    <span class="c1"># Initialize the matrices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;design&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">&#39;selection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k_states</span><span class="p">)</span>

    <span class="c1"># Cache some indices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_cov_idx</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;state_cov&#39;</span><span class="p">,)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="n">k_posdef</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="aitana.tilde"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h1 id="aitana.tilde.tilde_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tilde_request</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>Request data from the tilde API (https://tilde.geonet.org.nz/v3/api-docs/).
See the tilde discovery tool for more information:
https://tilde.geonet.org.nz/ui/data-discovery/</p>
<h3 id="aitana.tilde.tilde_request--parameters">Parameters</h3>
<p>domain : str
    The domain of the data (e.g. 'manualcollect')
name : str
    The name of the data (e.g. 'plume-SO2-gasflux')
station : str
    The station code (e.g. 'WI000')
method : str
    The method of the data (e.g. 'contouring')
sensor : str
    The sensor of the data (e.g. 'MC01')
aspect : str
    The aspect of the data (e.g. 'nil')
start_date : date
    The start date of the data
end_date : date
    The end date of the data</p>
<h3 id="aitana.tilde.tilde_request--returns">Returns</h3>
<p>pd.DataFrame
    A pandas dataframe with the requested data</p>

            <details class="quote">
              <summary>Source code in <code>src/aitana/tilde.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tilde_request</span><span class="p">(</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
    <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">station</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">sensor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">aspect</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Request data from the tilde API (https://tilde.geonet.org.nz/v3/api-docs/).</span>
<span class="sd">    See the tilde discovery tool for more information:</span>
<span class="sd">    https://tilde.geonet.org.nz/ui/data-discovery/</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    domain : str</span>
<span class="sd">        The domain of the data (e.g. &#39;manualcollect&#39;)</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the data (e.g. &#39;plume-SO2-gasflux&#39;)</span>
<span class="sd">    station : str</span>
<span class="sd">        The station code (e.g. &#39;WI000&#39;)</span>
<span class="sd">    method : str</span>
<span class="sd">        The method of the data (e.g. &#39;contouring&#39;)</span>
<span class="sd">    sensor : str</span>
<span class="sd">        The sensor of the data (e.g. &#39;MC01&#39;)</span>
<span class="sd">    aspect : str</span>
<span class="sd">        The aspect of the data (e.g. &#39;nil&#39;)</span>
<span class="sd">    start_date : date</span>
<span class="sd">        The start date of the data</span>
<span class="sd">    end_date : date</span>
<span class="sd">        The end date of the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        A pandas dataframe with the requested data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tilde_url</span> <span class="o">=</span> <span class="s2">&quot;https://tilde.geonet.org.nz/v4/data&quot;</span>
    <span class="c1"># split the request into historic and latest data</span>
    <span class="n">get_historic</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">get_latest</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="n">_tstart</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
    <span class="n">_tend</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
    <span class="n">_today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">end_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">_today</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">29</span><span class="p">)):</span>
        <span class="n">_tend</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">end_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">29</span><span class="p">)))</span>
        <span class="n">get_latest</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">start_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">_today</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">29</span><span class="p">)):</span>
        <span class="n">get_historic</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">assert</span> <span class="n">get_historic</span> <span class="ow">or</span> <span class="n">get_latest</span><span class="p">,</span> <span class="s2">&quot;Check start and end dates.&quot;</span>

    <span class="k">if</span> <span class="n">get_latest</span><span class="p">:</span>
        <span class="n">latest</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tilde_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sensor</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">aspect</span><span class="si">}</span><span class="s2">/latest/30d&quot;</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">latest</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/csv&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">rval</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Download of </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2"> failed with status code </span><span class="si">{</span><span class="n">rval</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; and url </span><span class="si">{</span><span class="n">latest</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">df_latest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">rval</span><span class="o">.</span><span class="n">text</span><span class="p">),</span>
            <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
            <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span>
            <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">],</span>
            <span class="n">date_format</span><span class="o">=</span><span class="s2">&quot;ISO8601&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">get_historic</span><span class="p">:</span>
        <span class="n">historic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tilde_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sensor</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">aspect</span><span class="si">}</span><span class="s2">/&quot;</span>
        <span class="n">historic</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tstart</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">_tend</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">historic</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/csv&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">rval</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Download of </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2"> failed with status code </span><span class="si">{</span><span class="n">rval</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; and url </span><span class="si">{</span><span class="n">historic</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">rval</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">df_historic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
            <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span>
            <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">],</span>
            <span class="n">date_format</span><span class="o">=</span><span class="s2">&quot;ISO8601&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">get_latest</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_latest</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_historic</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df_latest</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_historic</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df_latest</span>
    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;err&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;dt&quot;</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start_date</span><span class="p">:</span><span class="n">end_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="aitana.wfs"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h1 id="aitana.wfs.wfs_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wfs_request</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">center_point</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxdepth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span></code>

</h1>


    <div class="doc doc-contents ">

        <p>Load volcano-tectonic earthquake catalogues from GeoNet's WFS service (http://wfs.geonet.org.nz).</p>
<h3 id="aitana.wfs.wfs_request--parameters">Parameters:</h3>
<pre><code>polygon : str
    A string with the polygon coordinates in the format
    "lon1+lat1,lon2+lat2,...,lonN+latN,lon1+lat1"
radius : int
    The radius around the volcano summit in meters.
center_point : str
    The center point of the radius in the format "lon+lat".
maxdepth : int
    The maximum depth of the earthquakes in kilometers.
</code></pre>
<h3 id="aitana.wfs.wfs_request--returns">Returns:</h3>
<pre><code>pandas.DataFrame
    A dataframe with the earthquake catalogue.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/aitana/wfs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wfs_request</span><span class="p">(</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
    <span class="n">polygon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">center_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maxdepth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load volcano-tectonic earthquake catalogues from GeoNet&#39;s WFS service (http://wfs.geonet.org.nz).</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">        polygon : str</span>
<span class="sd">            A string with the polygon coordinates in the format</span>
<span class="sd">            &quot;lon1+lat1,lon2+lat2,...,lonN+latN,lon1+lat1&quot;</span>
<span class="sd">        radius : int</span>
<span class="sd">            The radius around the volcano summit in meters.</span>
<span class="sd">        center_point : str</span>
<span class="sd">            The center point of the radius in the format &quot;lon+lat&quot;.</span>
<span class="sd">        maxdepth : int</span>
<span class="sd">            The maximum depth of the earthquakes in kilometers.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A dataframe with the earthquake catalogue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wfs_url</span> <span class="o">=</span> <span class="s2">&quot;http://wfs.geonet.org.nz/geonet/ows?service=WFS&amp;version=1.0.0&quot;</span>
    <span class="k">if</span> <span class="n">polygon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either polygon or radius must be provided.&quot;</span><span class="p">)</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.0Z&quot;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">wfs_url</span>
    <span class="n">url</span> <span class="o">+=</span> <span class="p">(</span>
        <span class="s2">&quot;&amp;request=GetFeature&amp;typeName=geonet:quake_search_v1&amp;outputFormat=csv&quot;</span>
    <span class="p">)</span>
    <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;cql_filter=origintime&gt;=</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;+AND+DWITHIN(origin_geom,Point+(</span><span class="si">{</span><span class="n">center_point</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s2">,meters)+AND+depth&lt;</span><span class="si">{</span><span class="n">maxdepth</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">polygon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;+AND+WITHIN(origin_geom,POLYGON((</span><span class="si">{</span><span class="n">polygon</span><span class="si">}</span><span class="s2">)))+AND+depth&lt;</span><span class="si">{</span><span class="n">maxdepth</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;origintime&quot;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;origintime&quot;</span><span class="p">)</span>
    <span class="n">cat</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;There are no earthquakes available for&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;the selected date range (</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span><span class="si">}</span><span class="s2">) in &quot;</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;a radius of </span><span class="si">{}</span><span class="s2"> m&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">polygon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;the selected region: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../aitana_example/" class="btn btn-neutral float-left" title="How to use aitana"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../aitana_example/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
